/* === styles.css === */
/* ==========================================================================
   Professional TestGen Pro Styles - styles.css
   ========================================================================== */

/* Import Fonts (Example: Inter & Lexend Deca) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lexend+Deca:wght@400;500;600&display=swap');
/* ==========================================================================
   CSS Variables and Base Styles
   ========================================================================== */

:root {
    /* --- Primary Color Palette (Blue) --- */
    --color-primary-50:  #f0f9ff; /* Lightest Blue */
    --color-primary-100: #e0f2fe;
    --color-primary-200: #bae6fd;
    --color-primary-300: #7dd3fc;
    --color-primary-400: #38bdf8;
    --color-primary-500: #0ea5e9; /* Main Primary */
    --color-primary-600: #0284c7; /* Darker Primary */
    --color-primary-700: #0369a1;
    --color-primary-800: #075985;
    --color-primary-900: #0c4a6e; /* Darkest Blue */
    --color-primary-950: #082f49;

    /* --- Gray Scale Palette --- */
    --color-gray-50:   #f8fafc;  /* Light BG */
    --color-gray-100:  #f1f5f9;  /* Light BG / Borders */
    --color-gray-200:  #e2e8f0;  /* Borders */
    --color-gray-300:  #cbd5e1;  /* Subtle Borders / Disabled Text */
    --color-gray-400:  #94a3b8;  /* Muted Text */
    --color-gray-500:  #64748b;  /* Medium Text */
    --color-gray-600:  #475569;  /* Body Text (Dark) / Dark Borders */
    --color-gray-700:  #334155;  /* Darker Elements / Card BG (Dark) */
    --color-gray-800:  #1e293b;  /* Darker Card BG (Dark) */
    --color-gray-900:  #0f172a;  /* Dark BG */
    --color-gray-950:  #020617;  /* Darkest BG */

    /* --- Semantic Colors --- */
    --color-white:     #ffffff;
    --color-black:     #000000;

    --color-success-50:  #f0fdf4; /* Lighter Success */
    --color-success-100: #dcfce7;
    --color-success-200: #bbf7d0;
    --color-success-300: #86efac;
    --color-success-400: #4ade80;
    --color-success-500: #22c55e; /* Main Success */
    --color-success-600: #16a34a;
    --color-success-700: #15803d;
    --color-success-800: #166534;
    --color-success-900: #14532d;
    --color-success-950: #052e16;

    --color-danger-50:  #fff1f2; /* Lighter Danger */
    --color-danger-100: #ffe4e6;
    --color-danger-200: #fecdd3;
    --color-danger-300: #fda4af;
    --color-danger-400: #fb7185;
    --color-danger-500: #f43f5e; /* Main Danger */
    --color-danger-600: #e11d48;
    --color-danger-700: #be123c;
    --color-danger-800: #9f1239;
    --color-danger-900: #881337;
    --color-danger-950: #4c0519;

    --color-warning-50:  #fffbeb; /* Lighter Warning */
    --color-warning-100: #fef3c7;
    --color-warning-200: #fde68a;
    --color-warning-300: #fcd34d;
    --color-warning-400: #fbbf24;
    --color-warning-500: #f59e0b; /* Main Warning */
    --color-warning-600: #d97706;
    --color-warning-700: #b45309;
    --color-warning-800: #92400e;
    --color-warning-900: #78350f;
    --color-warning-950: #451a03;

    --color-info-50:  #eff6ff; /* Lighter Info */
    --color-info-100: #dbeafe;
    --color-info-200: #bfdbfe;
    --color-info-300: #93c5fd;
    --color-info-400: #60a5fa;
    --color-info-500: #3b82f6; /* Main Info */
    --color-info-600: #2563eb;
    --color-info-700: #1d4ed8;
    --color-info-800: #1e40af;
    --color-info-900: #1e3a8a;
    --color-info-950: #172554;

    /* --- Fonts --- */
    --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    --font-display: 'Lexend Deca', var(--font-sans); /* Optional distinct display font */
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    /* --- Transitions --- */
    --transition-fast: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-std:  all 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: all 400ms cubic-bezier(0.4, 0, 0.2, 1);

    /* --- Shadows --- */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    --shadow-inner: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);

    /* --- Borders --- */
    --border-radius-sm: 0.25rem; /* 4px */
    --border-radius:    0.375rem; /* 6px */
    --border-radius-md: 0.5rem;   /* 8px */
    --border-radius-lg: 0.75rem;  /* 12px */
    --border-radius-xl: 1rem;    /* 16px */
    --border-radius-full: 9999px;

    --border-color: var(--color-gray-200);
    --border-color-dark: var(--color-gray-700);
}

/* Basic Reset & Global Box Sizing */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border-width: 0;
    border-style: solid;
    border-color: var(--border-color); /* Default border color */
}
.dark *, .dark *::before, .dark *::after {
     border-color: var(--border-color-dark);
}

html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.5;
    font-size: 16px; /* Base font size */
    scroll-behavior: smooth;
}

body {
    font-family: var(--font-sans);
    background-color: var(--color-gray-50);
    color: var(--color-gray-700);
    transition: background-color var(--transition-std), color var(--transition-std);
    overflow: hidden; /* Prevent body scroll */
    height: 100vh;
}

.dark body {
    background-color: var(--color-gray-900);
    color: var(--color-gray-300);
}

/* ==========================================================================
   Main Layout
   ========================================================================== */

.app-layout { /* Applied to the main flex container */
    display: flex;
    height: 100vh;
}

/* Sidebar */
aside#sidebar {
    width: 16rem; /* w-64 */
    background-color: var(--color-white);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    height: 100vh;
    transition: width var(--transition-std), transform var(--transition-std), background-color var(--transition-std);
    box-shadow: var(--shadow-md);
    z-index: 20; /* Ensure above content */
}
.dark aside#sidebar {
    background-color: var(--color-gray-800);
    border-right-color: var(--border-color-dark);
}

/* Main Content Area */
main#main-content {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    background-color: var(--color-gray-100); /* Slightly different from body */
    transition: background-color var(--transition-std);
}
.dark main#main-content {
     background-color: var(--color-gray-950); /* Slightly darker */
}
main#main-content .container {
    max-width: 80rem; /* Limit content width */
    margin-left: auto;
    margin-right: auto;
    padding-left: 1rem;
    padding-right: 1rem;
}
@media (min-width: 640px) { main#main-content .container { padding-left: 1.5rem; padding-right: 1.5rem; } }
@media (min-width: 1024px) { main#main-content .container { padding-left: 2rem; padding-right: 2rem; } }


/* ==========================================================================
   Typography
   ========================================================================== */
h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    font-weight: 600;
    margin-bottom: 0.75em;
    line-height: 1.3;
    color: var(--color-gray-900);
}
h1 { font-size: 2rem; letter-spacing: -0.025em; } /* 32px */
h2 { font-size: 1.5rem; letter-spacing: -0.02em; } /* 24px */
h3 { font-size: 1.25rem; letter-spacing: -0.01em; } /* 20px */
h4 { font-size: 1.125rem; } /* 18px */

.dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6 {
    color: var(--color-gray-100);
}

p {
    margin-bottom: 1em;
    line-height: 1.65;
    color: var(--color-gray-600);
}
.dark p {
    color: var(--color-gray-400);
}

a.link, .link { /* Use .link class for consistent styling */
    color: var(--color-primary-600);
    text-decoration: none;
    transition: color var(--transition-fast);
}
a.link:hover, .link:hover {
    color: var(--color-primary-700);
    text-decoration: underline;
}
.dark a.link, .dark .link {
    color: var(--color-primary-400);
}
.dark a.link:hover, .dark .link:hover {
    color: var(--color-primary-300);
}


ul, ol {
    padding-left: 1.5em;
    margin-bottom: 1em;
}
li {
    margin-bottom: 0.4em;
}

strong, b { font-weight: 600; }
em, i { font-style: italic; }

code {
    font-family: var(--font-mono);
    background-color: var(--color-gray-100);
    color: var(--color-gray-700);
    padding: 0.2em 0.4em;
    border-radius: var(--border-radius-sm);
    font-size: 0.9em;
    border: 1px solid var(--border-color);
}
pre {
    background-color: var(--color-gray-100);
    padding: 1em;
    border-radius: var(--border-radius-md);
    overflow-x: auto;
    margin-bottom: 1em;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-inner);
    font-family: var(--font-mono);
    font-size: 0.9em; /* Slightly smaller pre text */
    line-height: 1.5;
}
pre code {
    background-color: transparent;
    padding: 0;
    border-radius: 0;
    font-size: 1em;
    border: none;
    box-shadow: none;
    white-space: pre-wrap; /* Ensure code inside pre wraps */
    word-wrap: break-word;
}

.dark code {
    background-color: var(--color-gray-700);
    color: var(--color-gray-200);
    border-color: var(--border-color-dark);
}
.dark pre {
    background-color: var(--color-gray-800);
    border-color: var(--border-color-dark);
}
.dark pre code {
    color: var(--color-gray-200);
}

hr {
    border-top: 1px solid var(--border-color);
    margin: 1.5em 0;
}
.dark hr {
    border-top-color: var(--border-color-dark);
}

/* Utility Text Styles */
.text-sm { font-size: 0.875rem; } /* 14px */
.text-xs { font-size: 0.75rem; } /* 12px */
.font-semibold { font-weight: 600; }
.font-medium { font-weight: 500; }
.font-bold { font-weight: 700; }
.text-center { text-align: center; }
.text-left { text-align: left; }
.text-right { text-align: right; }
.italic { font-style: italic; }
.truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.whitespace-pre-wrap { white-space: pre-wrap; } /* Useful for feedback/transcriptions */
.break-words { overflow-wrap: break-word; word-wrap: break-word; } /* Ensure long words break */
.line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 1; }

/* Color utilities */
.text-success { color: var(--color-success-600); }
.dark .text-success { color: var(--color-success-400); }
.text-danger { color: var(--color-danger-600); }
.dark .text-danger { color: var(--color-danger-400); }
.text-warning { color: var(--color-warning-600); }
.dark .text-warning { color: var(--color-warning-400); }
.text-info { color: var(--color-info-600); }
.dark .text-info { color: var(--color-info-400); }
.text-muted { color: var(--color-gray-500); }
.dark .text-muted { color: var(--color-gray-400); }

/* Background utilities (example) */
.bg-blue-100 { background-color: var(--color-primary-100); }
.dark .bg-blue-900-60 { background-color: rgba(12, 74, 110, 0.6); } /* #0c4a6e */
.bg-gray-100 { background-color: var(--color-gray-100); }
.dark .bg-gray-700 { background-color: var(--color-gray-700); }
.bg-gray-200 { background-color: var(--color-gray-200); }
.dark .bg-gray-900 { background-color: var(--color-gray-900); }

/* Border utilities */
.border-l-4 { border-left-width: 4px; }
.border-yellow-400 { border-color: var(--color-warning-400); }
.dark .border-yellow-500 { border-color: var(--color-warning-500); }
.border-l-2 { border-left-width: 2px; }
.border-blue-300 { border-color: var(--color-primary-300); }
.dark .border-blue-700 { border-color: var(--color-primary-700); }

/* ==========================================================================
   Sidebar Navigation & Header
   ========================================================================== */

/* Sidebar header */
#sidebar .sidebar-header {
    padding: 1.25rem 1rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0; /* Prevent shrinking */
}
#sidebar .sidebar-header a { /* Make logo/link clickable */
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}
#sidebar .sidebar-header h2 {
    font-family: var(--font-display);
    margin-bottom: 0;
    color: var(--color-primary-600);
    font-weight: 600;
    font-size: 1.3rem;
}
.dark #sidebar .sidebar-header {
     border-bottom-color: var(--border-color-dark);
}
.dark #sidebar .sidebar-header h2 {
    color: var(--color-primary-400);
}
/* Sidebar Header Logos */
#sidebar .sidebar-header .logo-light-mode { display: block; }
#sidebar .sidebar-header .logo-dark-mode { display: none; }
.dark #sidebar .sidebar-header .logo-light-mode { display: none; }
.dark #sidebar .sidebar-header .logo-dark-mode { display: block; }
#sidebar .sidebar-header .logo-light-mode,
#sidebar .sidebar-header .logo-dark-mode {
    height: 1.75rem; /* Adjusted logo size */
    width: auto;
}


/* Sidebar nav container */
#sidebar nav {
    flex-grow: 1;
    margin-top: 1rem;
    padding: 0 0.75rem;
    overflow-y: auto;
    display: flex; /* Changed from block */
    flex-direction: column; /* Ensure column layout */
    /* Apply custom scrollbar */
    scrollbar-width: thin;
    scrollbar-color: var(--color-gray-300) transparent;
}
#sidebar nav::-webkit-scrollbar { width: 6px; }
#sidebar nav::-webkit-scrollbar-track { background: transparent; }
#sidebar nav::-webkit-scrollbar-thumb { background-color: var(--color-gray-300); border-radius: 3px; border: 1px solid transparent; background-clip: padding-box; }
#sidebar nav::-webkit-scrollbar-thumb:hover { background-color: var(--color-gray-400); }

.dark #sidebar nav { scrollbar-color: var(--color-gray-600) transparent; }
.dark #sidebar nav::-webkit-scrollbar-thumb { background-color: var(--color-gray-600); }
.dark #sidebar nav::-webkit-scrollbar-thumb:hover { background-color: var(--color-gray-500); }


/* Sidebar links */
.sidebar-link {
    display: flex;
    align-items: center;
    padding: 0.65rem 0.85rem;
    margin-bottom: 0.25rem;
    font-size: 0.9rem; /* 14.4px */
    font-weight: 500;
    border-radius: var(--border-radius-md);
    color: var(--color-gray-600);
    transition: var(--transition-fast);
    text-decoration: none;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
    position: relative; /* For potential absolute positioned elements like badges */
}
.sidebar-link svg:not(.dropdown-arrow) { /* Don't style dropdown arrow */
    margin-right: 0.85rem;
    flex-shrink: 0;
    width: 1.125rem; /* 18px */
    height: 1.125rem;
    color: var(--color-gray-400);
    transition: color var(--transition-fast);
}

.sidebar-link:hover {
    background-color: var(--color-gray-100);
    color: var(--color-gray-900);
}
.sidebar-link:hover svg:not(.dropdown-arrow) {
    color: var(--color-primary-500);
}

/* Dark mode sidebar links */
.dark .sidebar-link {
    color: var(--color-gray-300);
}
.dark .sidebar-link svg:not(.dropdown-arrow) {
    color: var(--color-gray-500);
}
.dark .sidebar-link:hover {
    background-color: var(--color-gray-700);
    color: var(--color-white);
}
.dark .sidebar-link:hover svg:not(.dropdown-arrow) {
    color: var(--color-primary-400);
}

/* Active sidebar link */
.sidebar-link.active-link {
    background-color: var(--color-primary-50);
    color: var(--color-primary-600);
    font-weight: 600;
}
.sidebar-link.active-link svg:not(.dropdown-arrow) {
   color: var(--color-primary-600);
}
.dark .sidebar-link.active-link {
    background-color: var(--color-primary-900);
    color: var(--color-primary-300);
}
.dark .sidebar-link.active-link svg:not(.dropdown-arrow) {
   color: var(--color-primary-300);
}

/* Sidebar utility/theme area */
#sidebar .sidebar-footer {
    padding: 0.75rem;
    border-top: 1px solid var(--border-color);
    margin-top: auto; /* Push to bottom */
    flex-shrink: 0; /* Prevent shrinking */
}
.dark #sidebar .sidebar-footer {
    border-top-color: var(--border-color-dark);
}

/* Theme Toggle Button */
#theme-toggle {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0.5rem;
    border-radius: var(--border-radius-md);
    color: var(--color-gray-500);
    background-color: transparent;
    border: 1px solid transparent;
    transition: var(--transition-fast);
    cursor: pointer; /* Ensure cursor changes */
}
#theme-toggle:hover {
    background-color: var(--color-gray-100);
    color: var(--color-primary-500);
    border-color: var(--border-color);
}
.dark #theme-toggle {
    color: var(--color-gray-400);
}
.dark #theme-toggle:hover {
    background-color: var(--color-gray-700);
    color: var(--color-primary-400);
    border-color: var(--border-color-dark);
}
#theme-toggle svg {
    width: 1.25rem; /* 20px */
    height: 1.25rem;
}
/* Theme Icon Visibility */
html:not(.dark) #theme-icon-light { display: block; }
html:not(.dark) #theme-icon-dark { display: none; }
html.dark #theme-icon-light { display: none; }
html.dark #theme-icon-dark { display: block; }

/* Sidebar Inbox Badge */
#inbox-unread-count {
    background-color: var(--color-danger-500);
    color: var(--color-white);
    font-size: 0.65rem;
    font-weight: 600;
    padding: 0.1rem 0.4rem;
    border-radius: var(--border-radius-full);
    line-height: 1;
    min-width: 1.2rem;
    text-align: center;
    margin-left: auto; /* Push to the right */
}

/* --- NEW/MODIFIED: Sidebar Dropdown Styles --- */
.sidebar-dropdown-toggle {
    /* Ensure toggle button behaves like a link but can contain an icon */
    background: none;
    border: none;
    text-align: left;
    width: 100%;
    cursor: pointer;
    display: flex; /* Use flex to align items */
    justify-content: space-between; /* Space between text/icon and arrow */
}
.sidebar-dropdown-toggle .dropdown-arrow {
    transition: transform 0.2s ease-in-out;
    margin-left: auto; /* Push arrow to the right */
    color: var(--color-gray-400);
    width: 1rem; height: 1rem; /* Explicit size */
}
.dark .sidebar-dropdown-toggle .dropdown-arrow { color: var(--color-gray-500); }

.sidebar-dropdown-toggle.open .dropdown-arrow {
    transform: rotate(90deg);
}
.sidebar-dropdown-content {
    /* Initial state: hidden, no height */
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out, margin-top 0.3s ease-out;
    opacity: 0;
    /* Indent dropdown items */
    padding-left: 0.5rem;
    margin-left: 0.85rem; /* Align indentation roughly under parent icon */
    border-left: 1px dashed var(--color-gray-300);
    margin-top: 0;
}
.dark .sidebar-dropdown-content {
    border-left-color: var(--color-gray-600);
}
.sidebar-dropdown-content.open {
    max-height: 500px; /* Adjust as needed, large enough for content */
    opacity: 1;
    margin-top: 0.25rem; /* Add slight space when open */
    transition: max-height 0.4s ease-in, opacity 0.3s ease-in, margin-top 0.3s ease-in;
}
/* Style for active parent toggle (when child is active) */
.sidebar-dropdown-toggle.active-parent {
     background-color: var(--color-primary-50);
     color: var(--color-primary-600);
     font-weight: 600;
}
.dark .sidebar-dropdown-toggle.active-parent {
     background-color: var(--color-primary-900);
     color: var(--color-primary-300);
}
 .sidebar-dropdown-toggle.active-parent svg:not(.dropdown-arrow) { /* Don't color the arrow */
    color: var(--color-primary-600);
}
.dark .sidebar-dropdown-toggle.active-parent svg:not(.dropdown-arrow) {
   color: var(--color-primary-300);
}


/* ==========================================================================
   Admin Indicator Icon
   ========================================================================== */
.admin-icon {
    display: inline-block;
    margin-left: 0.3em;
    color: var(--color-warning-500);
    width: 0.8em;
    height: 0.8em;
    vertical-align: middle;
}
.dark .admin-icon {
    color: var(--color-warning-300);
}

/* ==========================================================================
   Button Styles
   ========================================================================== */

.btn,
.btn-primary, .btn-secondary, .btn-danger, .btn-success, .btn-warning,
.btn-primary-small, .btn-secondary-small, .btn-danger-small, .btn-success-small, .btn-warning-small {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.6rem 1.1rem;
    font-weight: 600;
    font-size: 0.875rem;
    line-height: 1.25rem;
    border-radius: var(--border-radius-md);
    border: 1px solid transparent;
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    white-space: nowrap;
    user-select: none;
    text-decoration: none; /* Ensure buttons acting as links look like buttons */
}

/* Focus visible state */
.btn:focus-visible,
.btn-primary:focus-visible, .btn-secondary:focus-visible, .btn-danger:focus-visible,
.btn-success:focus-visible, .btn-warning:focus-visible,
.btn-primary-small:focus-visible, .btn-secondary-small:focus-visible, .btn-danger-small:focus-visible,
.btn-success-small:focus-visible, .btn-warning-small:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
    border-radius: var(--border-radius-md); /* Ensure outline matches radius */
}
.dark .btn:focus-visible,
/* ... other dark mode focus styles ... */
.dark .btn-primary:focus-visible, .dark .btn-secondary:focus-visible, .dark .btn-danger:focus-visible,
.dark .btn-success:focus-visible, .dark .btn-warning:focus-visible,
.dark .btn-primary-small:focus-visible, .dark .btn-secondary-small:focus-visible, .dark .btn-danger-small:focus-visible,
.dark .btn-success-small:focus-visible, .dark .btn-warning-small:focus-visible {
    outline-color: var(--color-primary-400);
}
.btn-danger:focus-visible, .btn-danger-small:focus-visible { outline-color: var(--color-danger-500); }
.dark .btn-danger:focus-visible, .dark .btn-danger-small:focus-visible { outline-color: var(--color-danger-400); }
.btn-success:focus-visible, .btn-success-small:focus-visible { outline-color: var(--color-success-500); }
.dark .btn-success:focus-visible, .dark .btn-success-small:focus-visible { outline-color: var(--color-success-400); }
.btn-warning:focus-visible, .btn-warning-small:focus-visible { outline-color: var(--color-warning-500); }
.dark .btn-warning:focus-visible, .dark .btn-warning-small:focus-visible { outline-color: var(--color-warning-400); }


/* Disabled state */
button:disabled, .btn:disabled, a.btn:disabled,
/* ... other disabled styles ... */
.btn-primary:disabled, .btn-secondary:disabled, .btn-danger:disabled, .btn-success:disabled, .btn-warning:disabled,
.btn-primary-small:disabled, .btn-secondary-small:disabled, .btn-danger-small:disabled, .btn-success-small:disabled, .btn-warning-small:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
}

/* Primary Button */
.btn-primary { background-color: var(--color-primary-600); color: var(--color-white); }
.btn-primary:hover:not(:disabled) { background-color: var(--color-primary-700); box-shadow: var(--shadow); }
.dark .btn-primary { background-color: var(--color-primary-500); color: var(--color-white); } /* Fix: Use white text for dark primary */
.dark .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-400); }

/* Secondary Button */
.btn-secondary { background-color: var(--color-white); color: var(--color-gray-700); border-color: var(--color-gray-300); box-shadow: var(--shadow-sm); }
.btn-secondary:hover:not(:disabled) { background-color: var(--color-gray-50); border-color: var(--color-gray-400); box-shadow: var(--shadow); }
.dark .btn-secondary { background-color: var(--color-gray-700); color: var(--color-gray-200); border-color: var(--color-gray-600); }
.dark .btn-secondary:hover:not(:disabled) { background-color: var(--color-gray-600); border-color: var(--color-gray-500); }

/* Danger Button */
.btn-danger { background-color: var(--color-danger-600); color: var(--color-white); }
.btn-danger:hover:not(:disabled) { background-color: var(--color-danger-700); box-shadow: var(--shadow); }
.dark .btn-danger { background-color: var(--color-danger-500); }
.dark .btn-danger:hover:not(:disabled) { background-color: var(--color-danger-400); }

/* Success Button */
.btn-success { background-color: var(--color-success-600); color: var(--color-white); }
.btn-success:hover:not(:disabled) { background-color: var(--color-success-700); box-shadow: var(--shadow); }
.dark .btn-success { background-color: var(--color-success-500); }
.dark .btn-success:hover:not(:disabled) { background-color: var(--color-success-400); }

/* Warning Button */
.btn-warning { background-color: var(--color-warning-500); color: var(--color-gray-900); }
.btn-warning:hover:not(:disabled) { background-color: var(--color-warning-600); box-shadow: var(--shadow); }
.dark .btn-warning { background-color: var(--color-warning-400); color: var(--color-gray-900); }
.dark .btn-warning:hover:not(:disabled) { background-color: var(--color-warning-300); }

/* Small Button Variants */
.btn-primary-small, .btn-secondary-small, .btn-danger-small, .btn-success-small, .btn-warning-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.75rem; /* text-xs */
    font-weight: 500; /* Medium */
    box-shadow: none; /* Less shadow for small buttons */
}
.btn-success-small { background-color: var(--color-success-600); color: var(--color-white); }
.btn-success-small:hover:not(:disabled) { background-color: var(--color-success-700); }
.dark .btn-success-small { background-color: var(--color-success-500); }
.dark .btn-success-small:hover:not(:disabled) { background-color: var(--color-success-400); }
.btn-warning-small { background-color: var(--color-warning-500); color: var(--color-gray-900); }
.btn-warning-small:hover:not(:disabled) { background-color: var(--color-warning-600); }
.dark .btn-warning-small { background-color: var(--color-warning-400); color: var(--color-gray-900); }
.dark .btn-warning-small:hover:not(:disabled) { background-color: var(--color-warning-300); }
.btn-primary-small { background-color: var(--color-primary-600); color: var(--color-white); }
.btn-primary-small:hover:not(:disabled) { background-color: var(--color-primary-700); }
.dark .btn-primary-small { background-color: var(--color-primary-500); color: var(--color-white); } /* Fix: Use white text */
.dark .btn-primary-small:hover:not(:disabled) { background-color: var(--color-primary-400); }
.btn-secondary-small { background-color: var(--color-white); color: var(--color-gray-700); border-color: var(--color-gray-300); }
.btn-secondary-small:hover:not(:disabled) { background-color: var(--color-gray-50); }
.dark .btn-secondary-small { background-color: var(--color-gray-700); color: var(--color-gray-200); border-color: var(--color-gray-600); }
.dark .btn-secondary-small:hover:not(:disabled) { background-color: var(--color-gray-600); }
.btn-danger-small { background-color: var(--color-danger-600); color: var(--color-white); }
.btn-danger-small:hover:not(:disabled) { background-color: var(--color-danger-700); }
.dark .btn-danger-small { background-color: var(--color-danger-500); }
.dark .btn-danger-small:hover:not(:disabled) { background-color: var(--color-danger-400); }

/* Icon Only Buttons (Example) */
.btn-icon {
    padding: 0.5rem; /* Adjust padding for icon-only */
    line-height: 1;
    /* Apply specific color variant if needed */
}
.btn-icon svg { margin-right: 0 !important; width: 1.25rem; height: 1.25rem; } /* Ensure no margin */


/* Button Icons */
.btn svg, /* ... other button icon selectors ... */
.btn-primary svg, .btn-secondary svg, .btn-danger svg, .btn-success svg, .btn-warning svg,
.btn-primary-small svg, .btn-secondary-small svg, .btn-danger-small svg, .btn-success-small svg, .btn-warning-small svg {
    width: 1.125em; /* Size relative to text */
    height: 1.125em;
    flex-shrink: 0;
}
/* Corrected CSS for Button Icons */
.btn svg:not(:only-child),
.btn-primary svg:not(:only-child),
.btn-secondary svg:not(:only-child),
.btn-danger svg:not(:only-child),
.btn-success svg:not(:only-child),
.btn-warning svg:not(:only-child),
.btn-primary-small svg:not(:only-child),
.btn-secondary-small svg:not(:only-child),
.btn-danger-small svg:not(:only-child),
.btn-success-small svg:not(:only-child),
.btn-warning-small svg:not(:only-child) {
    margin-right: 0.5em; /* Add margin only if text is present */
}


/* ==========================================================================
   Form Control Styles
   ========================================================================== */

label {
    display: block;
    margin-bottom: 0.4rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-gray-700);
}
.dark label {
    color: var(--color-gray-300);
}

.form-control, /* Add a common class */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="number"],
input[type="url"],
input[type="search"],
select,
textarea {
    display: block;
    width: 100%;
    padding: 0.6rem 0.9rem;
    font-size: 0.9rem;
    font-family: var(--font-sans);
    line-height: 1.4;
    color: var(--color-gray-900);
    background-color: var(--color-white);
    background-clip: padding-box;
    border: 1px solid var(--color-gray-300);
    appearance: none; /* Remove default system appearance */
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-inner);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}
textarea { line-height: 1.5; min-height: 80px; }

select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.7rem center;
    background-size: 1.2em 1.2em;
    padding-right: 2.5rem;
}
.dark select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23cbd5e1' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
}

.form-control:focus,
input:focus, select:focus, textarea:focus {
    border-color: var(--color-primary-500);
    outline: 0;
    box-shadow: var(--shadow-inner), 0 0 0 3px rgba(14, 165, 233, 0.25); /* primary-500 with opacity */
}

.dark .form-control,
.dark input[type="text"],
/* ... other dark input types ... */
.dark input[type="email"], .dark input[type="password"], .dark input[type="number"], .dark input[type="url"], .dark input[type="search"],
.dark select,
.dark textarea {
    color: var(--color-gray-100);
    background-color: var(--color-gray-700);
    border-color: var(--color-gray-600);
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
}
.dark .form-control:focus,
.dark input:focus, .dark select:focus, .dark textarea:focus {
    border-color: var(--color-primary-400);
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2), 0 0 0 3px rgba(56, 189, 248, 0.3); /* primary-400 with opacity */
}

/* Invalid input styles */
input:invalid, select:invalid, textarea:invalid,
.form-control.is-invalid, /* Use a class for explicit errors */
input.border-red-500, textarea.border-red-500, select.border-red-500 /* Tailwind compatibility */
{
    border-color: var(--color-danger-500) !important;
}
input:invalid:focus, select:invalid:focus, textarea:invalid:focus,
.form-control.is-invalid:focus,
input.border-red-500:focus, textarea.border-red-500:focus, select.border-red-500:focus
{
    box-shadow: var(--shadow-inner), 0 0 0 3px rgba(244, 63, 94, 0.25) !important; /* danger-500 with opacity */
}
.dark input:invalid:focus, .dark select:invalid:focus, .dark textarea:invalid:focus,
.dark .form-control.is-invalid:focus,
.dark input.border-red-500:focus, .dark textarea.border-red-500:focus, .dark select.border-red-500:focus
{
     /* FIX: Use danger-500 alpha for stronger focus ring in dark mode */
     box-shadow: inset 0 1px 2px rgba(0,0,0,0.2), 0 0 0 3px rgba(244, 63, 94, 0.3) !important; /* danger-500 with opacity */
}

input[type="checkbox"], input[type="radio"] {
    height: 1rem; width: 1rem;
    border: 1px solid var(--color-gray-400);
    color: var(--color-primary-600);
    transition: var(--transition-fast);
    flex-shrink: 0; vertical-align: middle;
    appearance: none; background-color: var(--color-white);
    position: relative; cursor: pointer; display: inline-block;
}
input[type="checkbox"] { border-radius: var(--border-radius-sm); }
input[type="radio"] { border-radius: 50%; }

input[type="checkbox"]:focus, input[type="radio"]:focus {
     outline: none;
     box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.25); /* primary-500 with opacity */
}
input[type="checkbox"]:checked, input[type="radio"]:checked {
    border-color: var(--color-primary-500);
    background-color: var(--color-primary-500);
}
input[type="radio"]:checked { background-color: var(--color-white); } /* Radio keeps white bg */

input[type="checkbox"]:checked::before {
    content: ""; display: block; width: 0.3rem; height: 0.6rem;
    border: solid var(--color-white); border-width: 0 2px 2px 0;
    transform: rotate(45deg) translate(-50%, -50%);
    position: absolute; left: 50%; top: 45%;
}
input[type="radio"]:checked::before {
    content: ""; display: block; width: 0.5rem; height: 0.5rem;
    background-color: var(--color-primary-500); border-radius: 50%;
    position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
}

.dark input[type="checkbox"], .dark input[type="radio"] {
    border-color: var(--color-gray-500); background-color: var(--color-gray-600);
}
.dark input[type="checkbox"]:focus, .dark input[type="radio"]:focus {
     box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3); /* primary-400 with opacity */
}
.dark input[type="checkbox"]:checked, .dark input[type="radio"]:checked {
    border-color: var(--color-primary-400); background-color: var(--color-primary-400);
}
.dark input[type="radio"]:checked { background-color: var(--color-gray-600); }
.dark input[type="radio"]:checked::before { background-color: var(--color-primary-400); }

/* Form helper text */
.form-help-text {
    font-size: 0.75rem;
    color: var(--color-gray-500);
    margin-top: 0.25rem;
}
.dark .form-help-text {
    color: var(--color-gray-400);
}
.form-error-text { /* Style for error messages */
    font-size: 0.75rem;
    color: var(--color-danger-600);
    margin-top: 0.25rem;
}
.dark .form-error-text {
     color: var(--color-danger-400);
}


/* ==========================================================================
   Main Application Card & Content Area
   ========================================================================== */

/* Main card structure */
.content-card {
    background-color: var(--color-white);
    padding: 1.5rem 2rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    transition: background-color var(--transition-std), box-shadow var(--transition-std);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
}
.dark .content-card {
    background-color: var(--color-gray-800);
    border-color: var(--border-color-dark);
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.2), 0 1px 2px -1px rgb(0 0 0 / 0.2);
}

/* Card Header Area */
#card-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
}
.dark #card-header {
    border-bottom-color: var(--border-color-dark);
}
#subject-info p { margin-bottom: 0.1rem; }
#subject-info .font-semibold { color: var(--color-gray-800); }
.dark #subject-info .font-semibold { color: var(--color-gray-100); }

#user-section #user-display img {
    width: 2.25rem; height: 2.25rem; /* w-9 h-9 */
    border-radius: var(--border-radius-full);
    object-fit: cover;
    border: 2px solid var(--color-white);
    box-shadow: var(--shadow-sm);
}
.dark #user-section #user-display img {
    border-color: var(--color-gray-700);
}

/* Login/Signup Section */
#login-section {
    max-width: 28rem; /* limit width */
    margin: 2rem auto; /* Center vertically/horizontally */
    padding: 1.5rem 2rem;
}

/* Dynamic Content Area (#content) */
#content {
    margin-top: 1rem;
}
/* Progress Dashboard Area (#dashboard) */
#dashboard {
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-lg);
    margin-bottom: 1.5rem;
    background-color: var(--color-gray-50);
    padding: 1.5rem; /* Add padding to the dashboard container */
}
.dark #dashboard {
    border-color: var(--border-color-dark);
    background-color: var(--color-gray-800);
}
#dashboard-content .grid > div { /* Style dashboard cards */
    background-color: var(--color-white);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    min-height: 18rem; /* Ensure consistent height */
    padding: 1rem; /* Add padding inside cards */
    display: flex;
    flex-direction: column;
}
.dark #dashboard-content .grid > div {
    background-color: var(--color-gray-700);
    border-color: var(--border-color-dark);
}
#dashboard-content h3, #dashboard-content h4 {
    font-family: var(--font-sans);
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-gray-700);
    flex-shrink: 0; /* Prevent header shrinking */
}
.dark #dashboard-content h3, .dark #dashboard-content h4 { color: var(--color-gray-300); }
#dashboard-content .chart-container { /* Ensure chart fills space */
    flex-grow: 1;
    position: relative; /* Needed for Chart.js responsiveness */
    min-height: 150px; /* Prevent collapsing */
}

/* Course Dashboard Area (#course-dashboard-area) */
#course-dashboard-area {
    margin-top: 1rem;
}
/* Individual cards within course dashboard can use .content-card */

/* Online Test Area */
#online-test-area .fixed { /* Header/Footer */
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px); /* Safari */
    border-color: var(--border-color);
    box-shadow: var(--shadow-md);
    z-index: 10; /* Ensure above content */
}
.dark #online-test-area .fixed {
    background-color: rgba(15, 23, 42, 0.9); /* gray-950 */
    border-color: var(--border-color-dark);
}
#online-test-area #question-container {
    padding-top: 5.5rem; /* Space for fixed header */
    padding-bottom: 6.5rem; /* Space for fixed footer */
}
#timer {
    font-family: var(--font-mono);
    background-color: var(--color-gray-200);
    color: var(--color-gray-800);
    padding: 0.25rem 0.75rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 1.1rem; /* Slightly larger */
}
.dark #timer {
    background-color: var(--color-gray-700);
    color: var(--color-gray-100);
}
#timer.text-red-500, #timer.text-danger { color: var(--color-danger-500) !important; } /* Ensure override */
.dark #timer.text-red-500, .dark #timer.text-danger { color: var(--color-danger-400) !important; }


/* Online Test Question Styling */
#online-test-area .question-card {
    background-color: var(--color-white);
    padding: 1.5rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    margin-bottom: 1rem;
    animation: fadeIn 0.3s ease-out forwards;
}
.dark #online-test-area .question-card {
    background-color: var(--color-gray-800);
    border-color: var(--border-color-dark);
}
#online-test-area .option-label { /* Style the label containing radio+text */
    display: flex;
    align-items: flex-start;
    padding: 0.8rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: var(--transition-fast);
    background-color: var(--color-gray-50);
    margin-bottom: 0.5rem; /* Space between options */
}
#online-test-area .option-label:hover {
    background-color: var(--color-gray-100);
    border-color: var(--color-gray-300);
}
/* Styling when the hidden radio is checked */
#online-test-area input[type="radio"] {
    position: absolute; /* Hide the actual radio */
    opacity: 0;
    pointer-events: none;
}
#online-test-area input[type="radio"]:checked + .option-label {
    border-color: var(--color-primary-500);
    background-color: var(--color-primary-50);
    box-shadow: 0 0 0 1px var(--color-primary-500);
}
.dark #online-test-area .option-label {
    background-color: var(--color-gray-700);
    border-color: var(--border-color-dark);
}
.dark #online-test-area .option-label:hover {
    background-color: var(--color-gray-600);
    border-color: var(--color-gray-500);
}
.dark #online-test-area input[type="radio"]:checked + .option-label {
    border-color: var(--color-primary-400);
    background-color: var(--color-primary-900);
    box-shadow: 0 0 0 1px var(--color-primary-400);
}
/* Custom radio appearance */
#online-test-area .option-label::before {
    content: "";
    display: inline-block;
    width: 1rem;
    height: 1rem;
    border: 1px solid var(--color-gray-400);
    border-radius: 50%;
    margin-right: 0.75rem;
    flex-shrink: 0;
    background-color: var(--color-white);
    transition: var(--transition-fast);
    margin-top: 0.15em; /* Align better */
}
.dark #online-test-area .option-label::before {
    border-color: var(--color-gray-500);
    background-color: var(--color-gray-600);
}
/* Checked state for custom radio */
#online-test-area input[type="radio"]:checked + .option-label::before {
    border-color: var(--color-primary-500);
    background-color: var(--color-white); /* Keep background white */
    box-shadow: inset 0 0 0 4px var(--color-primary-500); /* Inner circle */
}
.dark #online-test-area input[type="radio"]:checked + .option-label::before {
    border-color: var(--color-primary-400);
    background-color: var(--color-gray-600); /* Dark background */
    box-shadow: inset 0 0 0 4px var(--color-primary-400); /* Inner circle */
}

#online-test-area .option-text-container p:last-child { margin-bottom: 0; }
#online-test-area .option-text-container ul, #online-test-area .option-text-container ol { margin-top: 0.5em; margin-bottom: 0.5em; padding-left: 1.2em; }
/* Fix for MathJax alignment within options */
#online-test-area .option-text-container mjx-container > svg { vertical-align: -0.2ex !important; }

/* Ensure prose styles apply correctly within rendered content */
.prose { max-width: none; } /* Disable max-width constraint */
.prose p { margin: 0.75em 0; }
.prose ul, .prose ol { margin: 0.75em 0; padding-left: 1.6em; }
.prose li { margin: 0.25em 0; }
.prose code:not(pre code) { font-size: 0.85em; } /* Target only inline code */
.prose pre { font-size: 0.85em; }
/* Ensure dark mode prose colors */
.dark .prose {
  --tw-prose-body: var(--color-gray-300);
  --tw-prose-headings: var(--color-gray-100);
  --tw-prose-lead: var(--color-gray-400);
  --tw-prose-links: var(--color-primary-400);
  --tw-prose-bold: var(--color-gray-100);
  --tw-prose-counters: var(--color-gray-400);
  --tw-prose-bullets: var(--color-gray-600);
  --tw-prose-hr: var(--color-gray-700);
  --tw-prose-quotes: var(--color-gray-100);
  --tw-prose-quote-borders: var(--color-gray-700);
  --tw-prose-captions: var(--color-gray-400);
  --tw-prose-code: var(--color-gray-100); /* Inline code text */
  --tw-prose-pre-code: var(--color-gray-300); /* Code block text */
  --tw-prose-pre-bg: var(--color-gray-800); /* Code block background */
  --tw-prose-th-borders: var(--color-gray-600);
  --tw-prose-td-borders: var(--color-gray-700);
}
.dark .prose code:not(pre code) { background-color: var(--color-gray-700); border-color: var(--border-color-dark); } /* Dark inline code bg */


/* ==========================================================================
   Loading, Alerts, Misc UI
   ========================================================================== */

/* Loading Animation */
.loader {
    border: 3px solid var(--color-primary-200);
    border-left-color: var(--color-primary-500);
    border-radius: 50%;
    width: 1.75rem; /* 28px */
    height: 1.75rem;
    animation: spin 0.8s linear infinite;
}
.dark .loader {
    border-color: var(--color-primary-800);
    border-left-color: var(--color-primary-400);
}
@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Loading Overlay */
#loading-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(248, 250, 252, 0.7); /* gray-50 */
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px); /* Safari */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    transition: opacity 0.3s ease-in-out;
    opacity: 0; /* Hidden by default */
    pointer-events: none; /* Not interactive by default */
}
#loading-overlay.visible { /* Class to show overlay */
    opacity: 1;
    pointer-events: auto;
}
#loading-overlay > div { /* Inner container */
    background-color: var(--color-white);
    padding: 1.5rem 2rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    display: flex;
    align-items: center;
    gap: 1rem;
    border: 1px solid var(--border-color);
}
#loading-overlay p {
    font-size: 1rem;
    font-weight: 500;
    color: var(--color-gray-700);
    margin-bottom: 0;
}
.dark #loading-overlay {
    background-color: rgba(15, 23, 42, 0.7); /* gray-900 */
}
.dark #loading-overlay > div {
    background-color: var(--color-gray-800);
    border-color: var(--border-color-dark);
}
.dark #loading-overlay p {
    color: var(--color-gray-200);
}

/* Toast / Notification */
.toast-notification {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    z-index: 110;
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid transparent;
    padding: 0.8rem 1.2rem;
    display: flex;
    align-items: center;
    max-width: 350px;
    animation: toastIn 0.4s ease-out forwards;
    background-clip: padding-box;
}
@keyframes toastIn {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
}
@keyframes toastOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
}
.toast-notification.fade-out {
    animation: toastOut 0.4s ease-in forwards;
}

.toast-notification p { margin-bottom: 0; font-size: 0.9rem; }
.toast-notification .toast-icon { width: 1.25rem; height: 1.25rem; margin-right: 0.75rem; flex-shrink: 0; }
/* Success Toast */
.toast-success { background-color: var(--color-success-100); color: var(--color-success-800); border-color: var(--color-success-300); }
.dark .toast-success { background-color: var(--color-success-900); color: var(--color-success-100); border-color: var(--color-success-700); }
/* Error Toast */
.toast-error { background-color: var(--color-danger-100); color: var(--color-danger-800); border-color: var(--color-danger-300); }
.dark .toast-error { background-color: var(--color-danger-900); color: var(--color-danger-100); border-color: var(--color-danger-700); }
/* Warning Toast */
.toast-warning { background-color: var(--color-warning-100); color: var(--color-warning-800); border-color: var(--color-warning-300); }
.dark .toast-warning { background-color: var(--color-warning-900); color: var(--color-warning-100); border-color: var(--color-warning-700); }
/* Info Toast */
.toast-info { background-color: var(--color-info-100); color: var(--color-info-800); border-color: var(--color-info-300); }
.dark .toast-info { background-color: var(--color-info-900); color: var(--color-info-100); border-color: var(--color-info-700); }


/* Chart Container */
canvas { max-width: 100%; height: auto !important; display: block; }

/* Custom Scrollbar (Subtle) - CONSOLIDATED SELECTORS */
body::-webkit-scrollbar,
main#main-content::-webkit-scrollbar,
aside nav::-webkit-scrollbar,
.overflow-y-auto::-webkit-scrollbar,
#global-chat-content::-webkit-scrollbar,
#mention-suggestion-popup::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

/* Track style */
body::-webkit-scrollbar-track,
main#main-content::-webkit-scrollbar-track,
aside nav::-webkit-scrollbar-track,
.overflow-y-auto::-webkit-scrollbar-track,
#global-chat-content::-webkit-scrollbar-track,
#mention-suggestion-popup::-webkit-scrollbar-track {
    background: transparent;
}

/* Thumb style */
body::-webkit-scrollbar-thumb,
main#main-content::-webkit-scrollbar-thumb,
aside nav::-webkit-scrollbar-thumb,
.overflow-y-auto::-webkit-scrollbar-thumb,
#global-chat-content::-webkit-scrollbar-thumb,
#mention-suggestion-popup::-webkit-scrollbar-thumb {
    background: var(--color-gray-300);
    border-radius: 4px;
    border: 2px solid transparent; /* Creates inset look */
}

/* Thumb hover style */
body::-webkit-scrollbar-thumb:hover,
main#main-content::-webkit-scrollbar-thumb:hover,
aside nav::-webkit-scrollbar-thumb:hover,
.overflow-y-auto::-webkit-scrollbar-thumb:hover,
#global-chat-content::-webkit-scrollbar-thumb:hover,
#mention-suggestion-popup::-webkit-scrollbar-thumb:hover {
    background: var(--color-gray-400);
}

/* Dark mode thumb style */
.dark body::-webkit-scrollbar-thumb,
.dark main#main-content::-webkit-scrollbar-thumb,
.dark aside nav::-webkit-scrollbar-thumb,
.dark .overflow-y-auto::-webkit-scrollbar-thumb,
.dark #global-chat-content::-webkit-scrollbar-thumb,
.dark #mention-suggestion-popup::-webkit-scrollbar-thumb {
    background: var(--color-gray-600);
}

/* Dark mode thumb hover style */
.dark body::-webkit-scrollbar-thumb:hover,
.dark main#main-content::-webkit-scrollbar-thumb:hover,
.dark aside nav::-webkit-scrollbar-thumb:hover,
.dark .overflow-y-auto::-webkit-scrollbar-thumb:hover,
.dark #global-chat-content::-webkit-scrollbar-thumb:hover,
.dark #mention-suggestion-popup::-webkit-scrollbar-thumb:hover {
    background: var(--color-gray-500);
}

/* Firefox scrollbar - CONSOLIDATED */
body,
main#main-content,
aside nav,
.overflow-y-auto,
#global-chat-content,
#mention-suggestion-popup {
    scrollbar-width: thin;
    scrollbar-color: var(--color-gray-300) transparent;
}
.dark body,
.dark main#main-content,
.dark aside nav,
.dark .overflow-y-auto,
.dark #global-chat-content,
.dark #mention-suggestion-popup {
    scrollbar-color: var(--color-gray-600) transparent;
}


/* Fade transition */
.animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ==========================================================================
   Course & Profile Specific Styles
   ========================================================================== */
.course-card h3 { margin-bottom: 0.25rem; }
.course-card .link { color: var(--color-info-600); font-weight: 500; word-break: break-all; }
.dark .course-card .link { color: var(--color-info-400); }
.course-card .link:hover { text-decoration: underline; }

/* Profile Badges */
.course-badge p { margin-bottom: 0.1rem; }

/* ==========================================================================
   Accessibility & Misc Fixes
   ========================================================================== */

:focus { outline: none; } /* Rely on focus-visible */
:focus-visible { /* Default focus style */
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
    border-radius: var(--border-radius-sm); /* Optional: add radius to outline */
}
.dark :focus-visible {
    outline-color: var(--color-primary-400);
}

/* More specific focus-visible for inputs/buttons to avoid double outlines */
.form-control:focus-visible, .btn:focus-visible, button:focus-visible, select:focus-visible, textarea:focus-visible, input[type="checkbox"]:focus-visible, input[type="radio"]:focus-visible {
    /* Use the specific focus styles defined earlier (box-shadow for inputs, outline for buttons) */
    outline: none; /* Prevent default focus-visible ring if custom style is applied */
}
.btn:focus-visible, button:focus-visible, .sidebar-link:focus-visible, a.link:focus-visible {
     outline: 2px solid var(--color-primary-500);
     outline-offset: 2px;
     border-radius: var(--border-radius-md);
}
.dark .btn:focus-visible, .dark button:focus-visible, .dark .sidebar-link:focus-visible, .dark a.link:focus-visible {
    outline-color: var(--color-primary-400);
}
/* ... other specific button focus colors */
.btn-danger:focus-visible, .dark .btn-danger:focus-visible { outline-color: var(--color-danger-500); }
.dark .btn-danger:focus-visible { outline-color: var(--color-danger-400); }

/* --- */

[aria-hidden="true"]:not([role="presentation"]) { display: none !important; } /* Allow presentation role */
.hidden { display: none !important; }
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }


/* MathJax / KaTeX Specific Safety Styles */
.katex-display, mjx-container[display="true"] {
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.5em 0;
    display: block;
    text-align: left !important; /* Override centering */
    max-width: 100%; /* Ensure it fits */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on mobile */
}
.katex-display > .katex { white-space: nowrap; } /* Prevent unwanted wrapping */
mjx-container > svg { vertical-align: baseline; max-width: 100%; } /* Ensure SVGs scale */

/* Image Styling */
img { max-width: 100%; height: auto; vertical-align: middle; }
.question-text-container img, .option-text-container img {
    display: block;
    margin: 1em auto;
    border: 1px solid var(--border-color);
    padding: 4px;
    border-radius: var(--border-radius-md);
    background-color: var(--color-white);
    max-width: calc(100% - 10px); /* Prevent overflow with padding */
}
.dark .question-text-container img, .dark .option-text-container img {
    border-color: var(--border-color-dark);
    background-color: var(--color-gray-700);
}

/* Details/Summary Styling */
details > summary {
    cursor: pointer;
    padding: 0.5em 0;
    font-weight: 500;
    color: var(--color-gray-700);
    transition: color var(--transition-fast);
    list-style: none; /* Remove default marker */
    display: flex;
    align-items: center;
    justify-content: space-between;
}
details > summary::-webkit-details-marker { display: none; } /* Hide marker in Webkit */
details > summary::before { /* Custom marker */
    content: ''; display: inline-block; margin-right: 0.5em;
    font-size: 0.7em; transition: transform var(--transition-fast);
    color: var(--color-gray-400);
    flex-shrink: 0;
}
details[open] > summary::before { transform: rotate(90deg); }
.dark details > summary { color: var(--color-gray-300); }
details > summary:hover { color: var(--color-primary-600); }
.dark details > summary:hover { color: var(--color-primary-400); }
details[open] > summary { margin-bottom: 0.5em; }
details > div { /* Content inside details */
    padding: 1em; background-color: var(--color-gray-50);
    border-radius: var(--border-radius-md); border: 1px solid var(--border-color);
    margin-top: 0.5em;
}
.dark details > div {
    background-color: var(--color-gray-700); border-color: var(--border-color-dark);
}

/* ==========================================================================
   Mobile Adjustments
   ========================================================================== */
@media (max-width: 767px) { /* md breakpoint */
    aside#sidebar {
        position: fixed; left: 0; top: 0; bottom: 0;
        z-index: 50; transform: translateX(-100%);
        border-right: none; box-shadow: var(--shadow-xl);
        width: 80%; /* Make sidebar wider on mobile */
        max-width: 20rem; /* Limit max width */
    }
    aside#sidebar.is-open { transform: translateX(0); }
    .mobile-overlay {
        position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6);
        z-index: 40; opacity: 0; transition: opacity 0.3s ease-in-out;
        pointer-events: none;
    }
     .mobile-overlay.is-visible { opacity: 1; pointer-events: auto; }
    /* Adjust content padding on mobile */
    .content-card { padding: 1rem 1.25rem; }
    main#main-content .container { padding-left: 0.75rem; padding-right: 0.75rem; }
    /* Adjust button padding slightly on mobile */
    .btn { padding: 0.55rem 1rem; font-size: 0.8rem; }
    .btn-small, .btn-primary-small, .btn-secondary-small, .btn-danger-small, .btn-success-small, .btn-warning-small { padding: 0.35rem 0.7rem; font-size: 0.7rem; }
    /* Adjust heading sizes */
    h1 { font-size: 1.75rem; }
    h2 { font-size: 1.375rem; }
    h3 { font-size: 1.125rem; }
    /* Reduce timer size */
    #timer { font-size: 1rem; padding: 0.2rem 0.5rem; }
    /* Online test options smaller */
    #online-test-area .option-label { padding: 0.6rem 0.8rem; font-size: 0.9rem; }
    #online-test-area .option-label::before { width: 0.9rem; height: 0.9rem; margin-right: 0.6rem; }
    /* Chat modal full screen on mobile */
    #global-chat-modal { padding: 0; }
    #global-chat-modal > div { max-width: 100%; height: 100%; border-radius: 0; }
}

/* --- Cropper.js Circular Styling --- */

/* Ensure the container Cropper generates fills the wrapper */
#cropper-wrapper .cropper-container {
    position: relative;
    width: 100%;
    height: 100%;
}

/* Style the preview box (view-box) to be circular */
.cropper-view-box {
    border-radius: 50%;
    outline: none;
     /* Use box-shadow to create the overlay *outside* the circle */
     /* Increase the spread radius (last value) significantly */
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
    /* Ensure image within is clipped */
     overflow: hidden;
}

/* Optional: Style the draggable crop box overlay (usually semi-transparent) */
.cropper-crop-box {
     /* Keep default cropper styles, potentially adjust outline if needed */
     outline: 1px solid #39f;
     border-radius: 50%; /* Match the view-box */
     overflow: hidden; /* Make sure inner elements respect the circle */
}

/* Hide the default rectangular face/drag elements if they appear */
.cropper-face,
.cropper-dashed,
.cropper-center {
    display: none !important;
}

/* Ensure drag lines are also hidden */
.cropper-line {
     background-color: transparent !important;
}

/* Optional: Style the handles if desired (might need adjustments) */
.cropper-point {
    background-color: #FFF; /* White handles might look better */
    opacity: 0.75;
    height: 6px;
    width: 6px;
    border-radius: 50%;
    box-shadow: 0 0 2px rgba(0,0,0,0.5); /* Add shadow for visibility */
}
/* Hide corner handles for a cleaner circle look */
.cropper-point.point-ne,
.cropper-point.point-nw,
.cropper-point.point-se,
.cropper-point.point-sw {
    /* display: none; */ /* Uncomment this to hide corner handles */
     opacity: 0.25; /* Or just make them less visible */
     pointer-events: none; /* Make them non-interactive */
}


/* Inbox Notification Dot (Original - for reference or other uses) */
.sidebar-link.has-unread::after {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: var(--color-danger-500);
    border-radius: 50%;
    margin-left: 0.5rem; /* Space between text/badge and dot */
    /* Optional animation: */
    animation: pulse 1.5s infinite cubic-bezier(0.66, 0, 0, 1);
}
@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.9); }
}

/* --- Chat Mention Styles --- */
.mention {
    background-color: var(--color-primary-100);
    color: var(--color-primary-700);
    font-weight: 500;
    padding: 0.1em 0.3em;
    border-radius: var(--border-radius-sm);
    cursor: default; /* Indicate it's not a link */
    display: inline-block; /* Prevent breaking mid-mention */
}
.dark .mention {
    background-color: var(--color-primary-800);
    color: var(--color-primary-200);
}

.mention-everyone {
    background-color: var(--color-warning-100);
    color: var(--color-warning-700);
    font-weight: 600;
}
.dark .mention-everyone {
    background-color: var(--color-warning-700);
    color: var(--color-warning-100);
}

.mention-me {
    background-color: var(--color-success-100);
    color: var(--color-success-700);
    font-weight: 600;
    /* Optional: Add a subtle border or glow */
    /* box-shadow: 0 0 0 1px var(--color-success-300); */
}
.dark .mention-me {
    background-color: var(--color-success-800); /* Darker success bg */
    color: var(--color-success-100);
     /* box-shadow: 0 0 0 1px var(--color-success-600); */ /* Adjusted shadow */
}

/* --- REMOVED: Sidebar Mention Notification Style --- */
/* Removed rules previously here for .sidebar-link.has-unread-mention */

/* --- Mention Suggestion Popup Styles --- */
#mention-suggestion-popup {
    position: absolute;
    z-index: 80; /* Above chat content, below modal */
    background-color: var(--color-white);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    max-height: 150px; /* Limit height */
    overflow-y: auto; /* Allow scrolling */
    min-width: 180px; /* Minimum width */
    /* bottom: 100%; Position above input - JS will handle exact placement */
    /* margin-bottom: 0.5rem; Space between input and popup */
}
.dark #mention-suggestion-popup {
    background-color: var(--color-gray-700);
    border-color: var(--border-color-dark);
}

#mention-suggestion-popup ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

#mention-suggestion-popup li {
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.875rem; /* text-sm */
    display: flex;
    align-items: center;
    transition: background-color 0.1s ease-in-out; /* Smooth hover */
}

#mention-suggestion-popup li:hover,
#mention-suggestion-popup li.active {
    background-color: var(--color-primary-100);
    color: var(--color-primary-700);
}
.dark #mention-suggestion-popup li:hover,
.dark #mention-suggestion-popup li.active {
    background-color: var(--color-primary-700);
    color: var(--color-primary-100);
}

#mention-suggestion-popup li img {
    width: 1.25rem; /* w-5 */
    height: 1.25rem; /* h-5 */
    border-radius: var(--border-radius-full);
    margin-right: 0.5rem; /* mr-2 */
    vertical-align: middle;
    flex-shrink: 0;
}

#mention-suggestion-popup li .font-medium {
    /* Default user display name styling */
    flex-grow: 1; /* Allow name to take space */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#mention-suggestion-popup li .text-xs {
    /* Username styling */
    color: var(--color-gray-500);
    flex-shrink: 0; /* Prevent username shrinking */
}
.dark #mention-suggestion-popup li .text-xs {
    color: var(--color-gray-400);
}

/* --- Pinned Message Highlight --- */
.pinned-message-highlight {
    background-color: rgba(251, 191, 36, 0.05); /* Very subtle yellow bg */
}
.dark .pinned-message-highlight {
    background-color: rgba(245, 158, 11, 0.1); /* Subtle dark yellow */
}

/* --- Chat Reply Context --- */
.reply-context {
    white-space: nowrap; /* Prevent wrapping for the main line */
    overflow: hidden;
    text-overflow: ellipsis;
}
.reply-context strong { font-weight: 600; }
.reply-context span.line-clamp-1 { /* Ensure preview clamps */
    display: inline; /* Let it flow with text */
}

/* --- Chat Message Bubble --- */
.message-bubble { /* Rounded bubble */
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal; /* Allow wrapping within bubble */
}
.message-content-holder {
     word-wrap: break-word;
     overflow-wrap: break-word;
     white-space: normal; /* Redundant but safe */
}
.message-content-holder pre { /* Ensure preformatted text wraps */
    white-space: pre-wrap;
    word-wrap: break-word;
}


/* --- Chat Action Buttons Hover --- */
/* Styles are set inline via Tailwind group-hover:opacity-50 etc */

/* --- Chat Input Textarea --- */
#global-chat-input {
    line-height: 1.4; /* Ensure consistent line height */
    padding-top: 0.6rem; /* Match padding */
    padding-bottom: 0.6rem;
}

/* --- Chat Header Logos --- */
#global-chat-modal .logo-light-mode { display: block; }
#global-chat-modal .logo-dark-mode { display: none; }
.dark #global-chat-modal .logo-light-mode { display: none; }
.dark #global-chat-modal .logo-dark-mode { display: block; }
#global-chat-modal .logo-light-mode,
#global-chat-modal .logo-dark-mode {
    width: 1.25rem; height: 1.25rem; /* w-5 h-5 */
}

/* --- Notification Ping Styles --- */
.notification-ping {
    /* MODIFIED: Hide by default */
    display: none;
    width: 10px; /* Ping size */
    height: 10px;
    border-radius: 50%;
    background-color: var(--color-danger-500); /* Red color */
    position: absolute; /* Position relative to parent */
    border: 1px solid var(--color-white); /* Optional white border */
    animation: ping-pulse 1.5s infinite cubic-bezier(0.66, 0, 0, 1); /* Keep animation */
}
.dark .notification-ping {
    border-color: var(--color-gray-800); /* Adjust border for dark mode */
}

/* Sidebar Chat Link (Base) */
.sidebar-link {
    position: relative; /* Needed for absolute positioning of the ping */
}
/* REMOVED: Chat-specific ping positioning and visibility rules */
/* .sidebar-link .chat-ping { ... } */
/* .sidebar-link.has-unread-mention .chat-ping { ... } */


/* Mobile Menu Button Ping */
#mobile-menu-button {
    position: relative; /* Needed for ping positioning */
}
#mobile-menu-button .menu-ping {
    top: 0px; /* Adjust position */
    right: 0px;
    width: 12px; /* Slightly larger */
    height: 12px;
     /* Hidden by default via base .notification-ping rule or .hidden utility */
}
/* Show menu ping when button has the class */
#mobile-menu-button.has-notification .menu-ping {
    /* MODIFIED: Ensure display is set */
    display: inline-block !important; /* Use !important to override default 'display: none' */
}

/* Optional Pulse Animation for pings (kept in base rule) */
@keyframes ping-pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}