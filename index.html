<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MODIFIED: Changed title -->
    <title>Lyceum - Your Personal Tutor</title>

    <!-- Favicons for light/dark mode -->
    <link rel="icon" href="./assets/images/branding/favicon-light.png" media="(prefers-color-scheme: light)">
    <link rel="icon" href="./assets/images/branding/favicon-dark.png" media="(prefers-color-scheme: dark)">
    <!-- Fallback/Default favicon -->
    <link rel="icon" href="./assets/images/branding/favicon-light.png">
    <!-- Default favicon -->
    <link rel="icon" href="./assets/images/branding/main_icon.ico">

    <!-- Tailwind CSS via CDN with Plugins -->
    <script src="https://cdn.tailwindcss.com?plugins=typography,aspect-ratio"></script>
    <script>
        // Tailwind config for dark mode and theme extensions ONLY
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: {} }
            // Plugins are loaded via URL parameter above
        };
    </script>

    <!-- MathJax Config -->
    <script>
      window.MathJax = {
        loader: { load: ['input/tex', 'output/svg'] },
        tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
        svg: { fontCache: 'global' }
      };
      console.log("MathJax config set (SVG Output).");
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="mathjax-script"></script>

    <!-- Chart.js (Using UMD version loaded globally now) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- html2pdf.js -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Mermaid.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <!-- jsPDF -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <!-- Google AI SDK -->
    <script type="module">
      try {
        await import('https://unpkg.com/@google/generative-ai?module');
        console.log("Google AI SDK loaded successfully.");
      } catch (error) {
        console.error("Failed to load Google AI SDK:", error);
      }
    </script>

    <!-- NEW: PDF.js Library (Stable version example) -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Worker script needed for PDF.js -->
    <script>
      // Set worker source path before PDF.js script loads if possible, or configure in JS
      // See config.js for the actual URL used
      // window.pdfjsWorkerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- NEW: YouTube IFrame Player API -->
    <!-- No script tag needed here, will be loaded asynchronously by JS -->

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- *** ADDED: Cropper.js CSS Link *** -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet">

    <!-- NEW: PDF Viewer Styles (Basic) & OTHER STYLES -->
    <style>
        /* --- START MODIFICATION: Removed overflow: auto from #pdf-viewer-container --- */
        #pdf-viewer-container { position: relative; border: 1px solid var(--border-color); background-color: var(--color-gray-200); }
        /* --- END MODIFICATION --- */
        .dark #pdf-viewer-container { border-color: var(--border-color-dark); background-color: var(--color-gray-700); }
        #pdf-canvas { display: block; margin: 0 auto; } /* Center canvas */
        #pdf-text-layer { position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; opacity: 0.2; line-height: 1.0; }
        #pdf-text-layer > span { color: transparent; position: absolute; white-space: pre; cursor: text; transform-origin: 0% 0%; }
        #pdf-text-layer ::selection { background: rgba(0, 0, 255, 0.3); }
        #pdf-controls { display: flex; justify-content: center; align-items: center; padding: 0.5rem; background-color: var(--color-gray-100); border-top: 1px solid var(--border-color); }
        .dark #pdf-controls { background-color: var(--color-gray-800); border-color: var(--border-color-dark); }

        /* Style to toggle logo based on theme */
        html.dark .logo-light-mode { display: none; }
        html:not(.dark) .logo-dark-mode { display: none; }

        /* Sidebar Dropdown Styles */
        .sidebar-dropdown-toggle .dropdown-arrow { transition: transform 0.2s ease-in-out; }
        .sidebar-dropdown-toggle.open .dropdown-arrow { transform: rotate(90deg); }
        .sidebar-dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding-left: 0.5rem; /* Indent dropdown items slightly */
        }
        .sidebar-dropdown-content.open {
            max-height: 500px; /* Adjust as needed, large enough for content */
            transition: max-height 0.4s ease-in-out;
        }
        /* Style for active parent toggle */
        .sidebar-dropdown-toggle.active-parent {
             background-color: var(--color-primary-50);
             color: var(--color-primary-600);
             font-weight: 600;
        }
        .dark .sidebar-dropdown-toggle.active-parent {
             background-color: var(--color-primary-900);
             color: var(--color-primary-300);
        }
         .sidebar-dropdown-toggle.active-parent svg:not(.dropdown-arrow) { /* Ensure icon color changes too */
            color: var(--color-primary-600);
        }
        .dark .sidebar-dropdown-toggle.active-parent svg:not(.dropdown-arrow) {
           color: var(--color-primary-300);
        }
         /* Styles for LaTeX code view in note modal */
         #note-view-content-area pre code {
             background-color: var(--color-gray-100);
             color: var(--color-gray-800);
             padding: 1em;
             border-radius: var(--border-radius-sm);
             font-family: var(--font-mono);
             font-size: 0.8rem; /* Smaller font for code */
         }
         .dark #note-view-content-area pre code {
              background-color: var(--color-gray-900);
              color: var(--color-gray-200);
              border: 1px solid var(--border-color-dark);
         }

        /* Chat Modal Styles (Basic) */
        /* Add more specific chat styles if needed */
        .chat-message { word-wrap: break-word; }

        /* Login/Signup Button States */
        #login-section .btn-secondary-small:disabled {
            background-color: var(--color-primary-100);
            color: var(--color-primary-700);
            cursor: not-allowed;
            font-weight: 600; /* Make active button bolder */
        }
        .dark #login-section .btn-secondary-small:disabled {
            background-color: var(--color-primary-800);
            color: var(--color-primary-200);
        }
        #login-section .btn-secondary-small:not(:disabled) {
            color: var(--color-gray-500); /* Less prominent when not active */
        }
         .dark #login-section .btn-secondary-small:not(:disabled) {
            color: var(--color-gray-400);
        }

        /* AI Chat Studio specific styles (can be moved to styles.css) */
        #ai-chat-sessions-sidebar {
            min-width: 200px; /* Ensure sidebar has a minimum width */
        }
        .message-bubble {
            word-break: break-word; /* Ensure long words break */
        }
        .message-content pre { /* Style for preformatted text within messages */
            white-space: pre-wrap; /* Allow wrapping within pre */
            word-wrap: break-word; /* Break long words in pre */
        }
        /* Ensure sidebar SVGs have consistent margin if text is present */
        .sidebar-link svg:not(:only-child) {
             margin-right: 0.75rem; /* approx 12px, adjust as needed */
        }

    </style>

</head>
<body>
    <!-- START MODIFICATION: Public Homepage Container with overflow and height -->
    <div id="public-homepage-container" class="hidden overflow-y-auto h-screen">
        <!-- Content from public_homepage.html will be injected here -->
    </div>
    <!-- END MODIFICATION -->

    <!-- START MODIFICATION: App Layout with height and flex -->
    <div class="app-layout hidden h-screen flex">
    <!-- END MODIFICATION -->
        <!-- Sidebar -->
        <aside id="sidebar" class="hidden md:flex">
             <!-- Sidebar Header -->
             <div class="sidebar-header">
                 <!-- MODIFIED: Increased logo size h-8 -> h-10 -->
                 <a href="#" onclick="window.showHomeDashboard(); return false;" class="flex items-center gap-2">
                     <img src="./assets/images/branding/logo-light.png" alt="Lyceum Logo" class="h-10 w-auto logo-light-mode">
                     <img src="./assets/images/branding/logo-dark.png" alt="Lyceum Logo Dark" class="h-10 w-auto logo-dark-mode">
                     <h2 title="Lyceum">Lyceum</h2>
                 </a>
             </div>
             <!-- Standard Nav -->
             <nav id="sidebar-standard-nav" class="flex-1 mt-4 px-3 space-y-1 auth-required" style="display: none;">
                 <!-- Main Home Link -->
                 <a href="#" onclick="window.showHomeDashboard(); return false;" class="sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
                    Home
                 </a>

                <!-- TestGen Dashboard Dropdown -->
                <div class="sidebar-dropdown">
                    <button onclick="toggleSidebarDropdown('testgen-dropdown-content', 'testgen-arrow')" class="sidebar-link sidebar-dropdown-toggle w-full text-left">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
                        TestGen Dashboard
                        <svg id="testgen-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 ml-auto dropdown-arrow"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 0 1 .02-1.06L11.168 10 7.23 6.29a.75.75 0 1 1 1.04-1.08l4.5 4.25a.75.75 0 0 1 0 1.08l-4.5 4.25a.75.75 0 0 1-1.06-.02Z" clip-rule="evenodd" /></svg>
                    </button>
                    <div id="testgen-dropdown-content" class="sidebar-dropdown-content space-y-1 pl-4">
                        <a href="#" onclick="showTestGenerationDashboard(); return false;" class="sidebar-link text-sm">
                             <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Generate Test
                        </a>
                        <a href="#" onclick="showManageStudiedChapters(); return false;" class="sidebar-link text-sm">
                             <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Studied Chapters
                        </a>
                        <a href="#" onclick="showExamsDashboard(); return false;" class="sidebar-link text-sm">
                             <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Exams Dashboard
                        </a>
                        <a href="#" onclick="showProgressDashboard(); return false;" class="sidebar-link text-sm">
                             <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Progress (Test Gen)
                        </a>
                        <a href="#" onclick="showManageSubjects(); return false;" class="sidebar-link text-sm">
                             <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Manage Subjects
                        </a>
                        <a href="#" onclick="window.showImportExportDashboard(); return false;" class="sidebar-link text-sm">
                            <svg class="w-4 h-4 opacity-0" viewBox="0 0 20 20" fill="currentColor"></svg>
                             Import / Export
                        </a>
                    </div>
                </div>
                <!-- End TestGen Dropdown -->

                <!-- Other Links -->
                 <a href="#" onclick="window.showBrowseCourses(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>
                     Browse Courses
                 </a>
                 <a href="#" onclick="window.showMyCoursesDashboard(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                    My Courses
                 </a>
                 <hr class="border-gray-200 dark:border-gray-700 my-2">
                 <!-- MODIFIED: Leaderboard and Marketplace links -->
                 <a href="#" onclick="window.showLeaderboard(); return false;" class="sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" /></svg>
                    Leaderboard
                 </a>
                 <a href="#" onclick="window.showMarketplacePlaceholder(); return false;" class="sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007Z" /></svg>
                    Marketplace <span class="text-xs text-primary-500 dark:text-primary-400 ml-1">(Soon)</span>
                 </a>
                 <hr class="border-gray-200 dark:border-gray-700 my-2">
                 <!-- END MODIFIED -->
                 <a href="#" onclick="showUserProfileDashboard(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                     Your Profile
                 </a>
                 <a href="#" id="sidebar-inbox-link" onclick="showInbox(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" /></svg>
                     Inbox
                     <span id="inbox-unread-count" class="ml-auto text-xs bg-red-500 text-white rounded-full px-1.5 py-0.5 hidden">0</span>
                 </a>

                 <!-- *** MODIFIED: REMOVED PING SPAN, Added AI Chat Studio Link *** -->
                 <a href="#" onclick="window.showGlobalChat(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                     Global Chat
                 </a>
                 <a href="#" onclick="window.showAiChatStudio(); return false;" class="sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-7.5h1.5m9 0h1.5" /></svg>
                    AI Chat Studio
                </a>
                 <!-- *** END GLOBAL CHAT & AI STUDIO LINK *** -->

                 <a href="#" id="admin-panel-link" onclick="showAdminDashboard(); return false;" class="sidebar-link" style="display: none;">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" /></svg>
                     Admin Panel
                 </a>
                 <!-- Import/Export moved inside TestGen dropdown -->
                 <a href="#" onclick="window.signOutUserWrapper(); return false;" class="sidebar-link !text-red-600 dark:!text-red-400 hover:!bg-red-50 dark:hover:!bg-red-900/50">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>
                     Log Out
                 </a>
             </nav>
             <!-- Course Nav -->
             <nav id="sidebar-course-nav" class="flex-1 mt-4 px-3 space-y-1 auth-required" style="display: none;">
                 <a href="#" onclick="window.showCurrentCourseDashboard(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
                     Course Dashboard
                 </a>
                 <a href="#" onclick="window.showNextLesson(); return false;" id="sidebar-next-lesson-link" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                     Next Lesson
                 </a>
                 <a href="#" onclick="window.showFullStudyMaterial(); return false;" id="sidebar-study-material-link" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>
                     Study Material
                 </a>
                 <!-- NEW: Notes & Documents Link -->
                 <a href="#" onclick="window.showCurrentNotesDocuments(); return false;" id="sidebar-notes-docs-link" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125M12.187 15.75l-3.75-3.75L12.187 15.75Z" /></svg>
                     Notes & Documents
                 </a>
                 <a href="#" onclick="window.showCurrentAssignmentsExams(); return false;" id="sidebar-assignments-exams-link" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08H4.123a.878.878 0 0 0-.878.878V18a2.25 2.25 0 0 0 2.25 2.25h3.879a.75.75 0 0 1 0 1.5H6.75a3.75 3.75 0 0 1-3.75-3.75V5.625a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 5.625V16.5a2.25 2.25 0 0 1-2.25 2.25h-3.879a.75.75 0 0 1 0-1.5Z" /></svg>
                     Assignments & Exams
                 </a>
                 <a href="#" onclick="window.showCurrentCourseProgress(); return false;" id="sidebar-course-progress-link" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" /></svg>
                     Course Progress
                 </a>
                 <hr class="border-gray-200 dark:border-gray-700 my-2">
                 <a href="#" onclick="window.showMyCoursesDashboard(); return false;" class="sidebar-link">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" /></svg>
                     Back to My Courses
                 </a>
             </nav>
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                 <button id="theme-toggle" aria-label="Toggle Dark Mode" title="Toggle Theme">
                     <svg id="theme-icon-dark" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.455 2.004a.75.75 0 0 1 .26.77 7 7 0 0 0 9.958 7.967.75.75 0 0 1 1.067.853A8.5 8.5 0 1 1 6.645 2.257a.75.75 0 0 1 .81.75Zm-1.99 1.838a6.5 6.5 0 1 0 9.193 9.193 6.5 6.5 0 0 0-9.193-9.193Z" clip-rule="evenodd" /></svg>
                     <svg id="theme-icon-light" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 2ZM10 15a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 15ZM10 7a3 3 0 1 0 0 6 3 3 0 0 0 0-6ZM15.657 5.404a.75.75 0 1 0-1.06-1.06l-1.061 1.06a.75.75 0 0 0 1.06 1.06l1.06-1.06ZM5.404 15.657a.75.75 0 1 0-1.06-1.06l-1.06 1.06a.75.75 0 0 0 1.06 1.06l1.06-1.06ZM18 10a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 18 10ZM5 10a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 5 10ZM14.596 15.657a.75.75 0 0 0 1.06-1.06l-1.06-1.061a.75.75 0 1 0-1.06 1.06l1.06 1.06ZM5.404 4.343a.75.75 0 0 0 1.06-1.06l-1.06-1.06a.75.75 0 1 0-1.061 1.06l1.06 1.061Z" /></svg>
                 </button>
             </div>
        </aside>

        <!-- Main Content Area -->
        <main id="main-content">
            <div class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">
                 <!-- Header Bar -->
                 <div class="flex justify-between items-center mb-5">
                      <!-- Mobile Menu Button - Always visible for structure -->
                      <button id="mobile-menu-button" class="text-gray-500 dark:text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600" aria-label="toggle menu">
                           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M2 4.75A.75.75 0 0 1 2.75 4h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.75ZM2 10a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 10Zm0 5.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 15.25Z" clip-rule="evenodd" /></svg>
                           <span class="notification-ping menu-ping hidden"></span>
                      </button>
                      <!-- Title Placeholder (Hidden on Desktop) -->
                      <h1 class="text-lg font-semibold text-primary-600 dark:text-primary-400 md:hidden flex-grow text-center">Lyceum</h1>

                      <!-- Desktop User Section (Right Aligned) -->
                      <div id="user-section" class="hidden md:flex items-center space-x-3 ml-auto">
                          <div id="user-display" class="flex items-center"></div>
                      </div>
                 </div>


                <!-- Application Content Wrapper -->
                <div id="app-content-wrapper">
                    <!-- Card Header Area - Only on desktop -->
                     <div id="card-header" class="mb-6 hidden md:flex">
                          <div id="subject-info">
                              <p class="text-sm text-gray-500 dark:text-gray-400">Loading...</p>
                          </div>
                          <!-- User info is now in the top bar for desktop -->
                     </div>

                     <!-- LOGIN/SIGNUP SECTION -->
                     <div id="login-section" class="hidden content-card max-w-md mx-auto">
                         <h2 class="text-xl font-semibold text-center mb-4">Welcome to Lyceum</h2>

                         <!-- Toggle Buttons -->
                         <div class="flex justify-center gap-4 mb-6">
                             <button id="show-login-view-btn" onclick="window.showLoginFormOnly()" class="btn-secondary-small px-4 py-1 text-sm font-semibold" disabled>Login</button>
                             <button id="show-signup-view-btn" onclick="window.showSignupFormOnly()" class="btn-secondary-small px-4 py-1 text-sm">Sign Up</button>
                         </div>

                         <!-- Login Form Container -->
                         <div id="login-form-container">
                             <form id="login-form" class="mb-6 space-y-4">
                                 <h3 class="text-lg font-medium text-center text-gray-800 dark:text-gray-200">Login</h3>
                                 <div>
                                     <label for="login-identifier">Email or Username</label>
                                     <input type="text" id="login-identifier" required placeholder="your@email.com or username" autocomplete="username">
                                 </div>
                                 <div>
                                     <label for="login-password">Password</label>
                                     <input type="password" id="login-password" required placeholder="••••••••" autocomplete="current-password">
                                     <!-- Forgot Password Link -->
                                     <div class="text-right mt-1">
                                         <a href="#" onclick="window.promptForgotPassword(); return false;" class="text-sm text-primary-600 hover:underline dark:text-primary-400">Forgot Password?</a>
                                     </div>
                                 </div>
                                 <button type="submit" class="w-full btn-primary">Login</button>
                             </form>
                         </div>

                         <!-- Signup Form Container -->
                         <div id="signup-form-container" class="hidden">
                             <form id="signup-form" class="mb-6 space-y-4">
                                 <h3 class="text-lg font-medium text-center text-gray-800 dark:text-gray-200">Sign Up</h3>
                                 <div>
                                     <label for="signup-username">Username</label>
                                     <input type="text" id="signup-username" required pattern="^[a-zA-Z0-9_]{3,20}$" title="3-20 chars, letters, numbers, _" placeholder="choose_a_username" autocomplete="username">
                                     <p class="form-help-text">3-20 chars, letters, numbers, _ only.</p>
                                 </div>
                                 <div>
                                     <label for="signup-email">Email</label>
                                     <input type="email" id="signup-email" required placeholder="your@email.com" autocomplete="email">
                                 </div>
                                 <div>
                                     <label for="signup-password">Password</label>
                                     <input type="password" id="signup-password" required minlength="6" placeholder="min. 6 characters" autocomplete="new-password">
                                     <p class="form-help-text">Must be at least 6 characters.</p>
                                 </div>
                                 <button type="submit" class="w-full btn-primary">Sign Up</button>
                             </form>
                         </div>

                         <!-- Separator and Google Sign-in -->
                         <hr class="my-6 border-gray-300 dark:border-gray-600"/>
                         <div class="text-center">
                             <p class="text-sm text-muted mb-3">Or sign in with:</p>
                             <button id="google-signin-button" class="btn-secondary inline-flex items-center">
                                 <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.283 10.356h-8.327v3.451h4.792c-.446 2.193-2.313 3.453-4.792 3.453a5.27 5.27 0 0 1-5.279-5.28 5.27 5.27 0 0 1 5.279-5.279c1.259 0 2.397.447 3.29 1.178l2.6-2.599c-1.584-1.381-3.615-2.233-5.89-2.233a8.908 8.908 0 0 0-8.934 8.934 8.907 8.907 0 0 0 8.934 8.934c4.467 0 8.529-3.249 8.529-8.934 0-.528-.081-1.097-.202-1.625z"></path></svg>
                                 Sign In with Google
                             </button>
                         </div>
                     </div>


                    <!-- Standard Dynamic Content Area -->
                    <div id="content" class="hidden"> <div class="text-center p-8 content-card"> <h2 class="text-xl font-semibold mb-3">Loading Lyceum...</h2> <p class="text-muted">Authenticating and loading your study data.</p> <div class="inline-block mt-4 loader animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-500"></div> </div> </div>

                     <!-- Standard Progress Dashboard Area -->
                     <div id="dashboard" class="hidden content-card">
                         <div class="flex justify-between items-center mb-4">
                             <h2 class="text-xl font-semibold text-primary-600 dark:text-primary-400 flex items-center">
                                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" /></svg>
                                 Progress Dashboard (Test Gen)
                             </h2>
                             <!-- MODIFIED: Changed onclick target -->
                             <button id="close-dashboard-button" onclick="window.showTestGenerationDashboard()" class="btn-secondary-small flex items-center" title="Close Dashboard">
                                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" /></svg>
                                 Back to TestGen
                             </button>
                         </div>
                         <div id="dashboard-content"></div>
                     </div>

                     <!-- Course Dashboard Area -->
                     <div id="course-dashboard-area" class="hidden"> <!-- Course specific content loads here --> </div>

                    <!-- Online Test Area -->
                    <div id="online-test-area" class="hidden"> <!-- Online test loads here --> </div>
                </div>
            </div>
        </main>
    </div> <!-- End of .app-layout -->

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay md:hidden"></div>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden"> <div> <div class="loader"></div> <p id="loading-message">Processing...</p> </div> </div>

    <!-- Firebase SDK & Config -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script>
      // Firebase config provided by user
      const firebaseConfig = {
        apiKey: "AIzaSyAZWLhgT89G5LjIA8IJLoA2LbifFl7yFhA", // Replace if necessary
        authDomain: "new-physics-test-bank.firebaseapp.com",
        projectId: "new-physics-test-bank",
        storageBucket: "new-physics-test-bank.appspot.com",
        messagingSenderId: "809292024755",
        appId: "1:809292024755:web:fb9b571dca9a7b811119c6",
        measurementId: "G-1M82PJ27DY"
      };
      try {
           if (!firebase.apps.length) {
              firebase.initializeApp(firebaseConfig);
              window.auth = firebase.auth();
              window.db = firebase.firestore();
              console.log("Firebase Initialized Successfully (End of Body)");
           }
       } catch (e) {
           console.error("Firebase Initialization Failed:", e);
           alert("Fatal Error: Could not initialize Firebase. Application may not function.");
       }
    </script>

    <!-- *** ADDED: Cropper.js Script *** -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

    <!-- Main Application Script -->
    <script type="module" src="script.js"></script>

</body>
</html>